<!doctype html><html lang="zh-CN" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="后端研发日志记录规范" /><meta property="og:locale" content="zh_CN" /><meta name="description" content="背景" /><meta property="og:description" content="背景" /><link rel="canonical" href="https://archzi.github.io/posts/log-conduct/" /><meta property="og:url" content="https://archzi.github.io/posts/log-conduct/" /><meta property="og:site_name" content="HeX" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-07-02T01:00:00+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="后端研发日志记录规范" /><meta name="twitter:site" content="@twitter_username" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2020-07-02T01:00:00+08:00","datePublished":"2020-07-02T01:00:00+08:00","description":"背景","headline":"后端研发日志记录规范","mainEntityOfPage":{"@type":"WebPage","@id":"https://archzi.github.io/posts/log-conduct/"},"url":"https://archzi.github.io/posts/log-conduct/"}</script><title>后端研发日志记录规范 | HeX</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="HeX"><meta name="application-name" content="HeX"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.21.0/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return 'mode'; } static get MODE_ATTR() { return 'data-mode'; } static get DARK_MODE() { return 'dark'; } static get LIGHT_MODE() { return 'light'; } static get ID() { return 'mode-toggle'; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener('change', () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia('(prefers-color-scheme: dark)'); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { document.documentElement.removeAttribute(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage( { direction: ModeToggle.ID, message: this.modeStatus }, '*' ); } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.notify(); } /* flipMode() */ } /* ModeToggle */ const modeToggle = new ModeToggle(); </script><body><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"> <img src="https://avatars.githubusercontent.com/u/19209941?s=400&u=e413893b42366b6cb405d3668217c262663bf0b5&v=4" width="112" height="112" alt="avatar" onerror="this.style.display='none'"> </a><div class="site-title"> <a href="/">HeX</a></div><div class="site-subtitle fst-italic">Happy coding, Happy living!</div></div><ul class="nav flex-column flex-grow-1 w-100 ps-0"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>首页</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>分类</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag"></i> <span>标签</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>归档</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info"></i> <span>关于</span> </a></ul><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/archzi" aria-label="github" target="_blank" rel="noopener noreferrer" > <i class="fab fa-github"></i> </a> <a href="javascript:location.href = 'mailto:' + ['archzi130','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container px-xxl-5"><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100" > <span id="breadcrumb"> <span> <a href="/"> 首页 </a> </span> <span>后端研发日志记录规范</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> 文章</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="搜索..." > </span> <span id="search-cancel">取消</span></div></div><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pe-xl-4"><div class="post px-1 px-md-2"><h1 data-toc-skip>后端研发日志记录规范</h1><div class="post-meta text-muted"> <span> 发表于 <em class="" data-ts="1593622800" data-df="YYYY/MM/DD" data-bs-toggle="tooltip" data-bs-placement="bottom" > 2020/07/02 </em> </span><div class="d-flex justify-content-between"> <span> 作者 <em> <a href="https://github.com/archzi">archzi</a> </em> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="1861 字" > <em>10 分钟</em>阅读</span></div></div></div><div class="post-content"><h2 id="背景"><span class="me-2">背景</span><a href="#背景" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><blockquote><p>日志：记录程序的运行轨迹，方便查找关键信息，也方便快速定位解决问题。</p></blockquote><p>随着公司发展，后端项目app的数量 越来越多，排查问题的复杂度越来越高，需要对日志的格式统一规划，便于后续日志收集分析报警。</p><h2 id="日志的作用why"><span class="me-2">日志的作用（WHY）</span><a href="#日志的作用why" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li><strong>问题追踪：</strong> 辅助排查和定位线上问题，优化程序运行性能。<li><strong>状态监控：</strong> 通过日志分析，可以监控系统的运行状态。<li><strong>安全审计：</strong> 审计主要体现在安全上，可以发现非授权的操作。</ul><h2 id="技术选型"><span class="me-2">技术选型</span><a href="#技术选型" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>经过调研，公司目前所有后端java 应用都是spring-boot 技术栈，而spring-boot的底层日志依赖关系如下图所示： <a href="/assets/img/post/2019110810594598.png" class="popup img-link "><img data-src="/assets/img/post/2019110810594598.png" alt="图片" class="lazyload" data-proofer-ignore></a></p><p>且，<code class="language-plaintext highlighter-rouge">logback</code>是 <code class="language-plaintext highlighter-rouge">slf4j</code>的默认实现，性能比<code class="language-plaintext highlighter-rouge">log4j</code>好很多,所以</p><ol><li>后端统一选择用<code class="language-plaintext highlighter-rouge">logback</code>作为日志记录依赖。<li>使用 <code class="language-plaintext highlighter-rouge">lombok</code> 插件增强添加 <code class="language-plaintext highlighter-rouge">log</code> 变量</ol><h2 id="记录规范-how"><span class="me-2">记录规范 (HOW)</span><a href="#记录规范-how" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="记录时机"><span class="me-2">记录时机</span><a href="#记录时机" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>当符合以下情况时，需要选择合适的级别记录日志：</p><ol><li>无法处理的 <code class="language-plaintext highlighter-rouge">RuntimeException</code>,结合实际情况选择 warn 级别或 error级别<li>执行流程不符合业务流程，比如：参数不正确，类型不正确和返回值不在预期范围内等。选择 Error 或 info 级别<li>系统关键角色，组件核心动作： 比如服务之间的交互，数据库增删改等需要记录 info级别日志。<li>常规初始化： 系统初始化的关键参数等，需要记录info级别日志。</ol><h3 id="如何记录格式规范"><span class="me-2">如何记录（格式规范）</span><a href="#如何记录格式规范" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>结合公司实际情况，日志记录应包含以下信息：</p><ol><li>日志时间（精确到毫秒）<li>日志级别<li>应用名称 - 项目名称<li>调用链标识（可选）- 唯一字段<li>业务标识<li>线程名称<li>记录器名称（class名方法名）<li>日志消息<li>异常栈（可选）</ol><h3 id="日志文件名规范"><span class="me-2">日志文件名规范</span><a href="#日志文件名规范" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>当前正在写入的日志文件名：<code class="language-plaintext highlighter-rouge">&lt;log-level&gt;.log</code></p><p>已经滚入历史的日志文件名：<code class="language-plaintext highlighter-rouge">&lt;log_level&gt;.log.&lt;yyyy-MM-dd&gt;</code></p><h3 id="禁止项"><span class="me-2">禁止项</span><a href="#禁止项" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ol><li>禁止使用 System.out/error 记录<li>禁止出现 e.printStackTrace()<li>禁止线上环境 出现 debug 日志<li>禁止循环中打印日志</ol><h2 id="日志配置文件和工具"><span class="me-2">日志配置文件和工具</span><a href="#日志配置文件和工具" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="配置文件"><span class="me-2">配置文件</span><a href="#配置文件" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-xml highlighter-rouge"><div class="code-header"> <span data-label-text="XML"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
</pre><td class="rouge-code"><pre>
<span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;configuration</span> <span class="na">scan=</span><span class="s">"true"</span> <span class="na">scanPeriod=</span><span class="s">"60 seconds"</span> <span class="na">debug=</span><span class="s">"false"</span><span class="nt">&gt;</span>

    <span class="c">&lt;!--读取spring 配置--&gt;</span>
    <span class="nt">&lt;springProperty</span> <span class="na">scope=</span><span class="s">"context"</span> <span class="na">name=</span><span class="s">"logPath"</span> <span class="na">source=</span><span class="s">"logging.file.path"</span> <span class="na">defaultValue=</span><span class="s">"logs"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;springProperty</span> <span class="na">scope=</span><span class="s">"context"</span> <span class="na">name=</span><span class="s">"appName"</span> <span class="na">source=</span><span class="s">"spring.application.name"</span> <span class="na">defaultValue=</span><span class="s">"ZL-PROJECT"</span><span class="nt">/&gt;</span>
    <span class="c">&lt;!--定义日志文件的存储地址 勿在 LogBack 的配置中使用相对路径--&gt;</span>

    <span class="c">&lt;!--配置--&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"appName"</span> <span class="na">value=</span><span class="s">"${appName}"</span><span class="nt">/&gt;</span>
    <span class="c">&lt;!--系统环境变量配置--&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"log.outside.level"</span> <span class="na">value=</span><span class="s">"DEBUG"</span><span class="nt">/&gt;</span>

    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"CONSOLE_LOG_PATTERN"</span>
              <span class="na">value=</span><span class="s">"%d{yyyy-MM-dd HH:mm:ss.SSS} [%contextName][bizId:%X{bizId}][%thread] %-5level %logger{50} [trackId:%X{trackId}] - %msg%n"</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;contextName&gt;</span>${appName}<span class="nt">&lt;/contextName&gt;</span>
    <span class="c">&lt;!-- 控制台输出 --&gt;</span>
    <span class="nt">&lt;appender</span> <span class="na">name=</span><span class="s">"STDOUT"</span> <span class="na">class=</span><span class="s">"ch.qos.logback.core.ConsoleAppender"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;encoder</span> <span class="na">class=</span><span class="s">"ch.qos.logback.classic.encoder.PatternLayoutEncoder"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;pattern&gt;</span>${CONSOLE_LOG_PATTERN}
            <span class="nt">&lt;/pattern&gt;</span>
        <span class="nt">&lt;/encoder&gt;</span>
    <span class="nt">&lt;/appender&gt;</span>
    <span class="c">&lt;!-- 按照每天生成日志文件 --&gt;</span>
    <span class="nt">&lt;appender</span> <span class="na">name=</span><span class="s">"ERROR"</span> <span class="na">class=</span><span class="s">"ch.qos.logback.core.rolling.RollingFileAppender"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;file&gt;</span>
            ${logPath}/error.log
        <span class="nt">&lt;/file&gt;</span>
        <span class="nt">&lt;rollingPolicy</span> <span class="na">class=</span><span class="s">"ch.qos.logback.core.rolling.TimeBasedRollingPolicy"</span><span class="nt">&gt;</span>
            <span class="c">&lt;!--日志文件输出的文件名--&gt;</span>
            <span class="nt">&lt;FileNamePattern&gt;</span>${logPath}/bak/error.log.%d{yyyy-MM-dd}<span class="nt">&lt;/FileNamePattern&gt;</span>
            <span class="c">&lt;!--日志文件保留天数--&gt;</span>
            <span class="nt">&lt;MaxHistory&gt;</span>30<span class="nt">&lt;/MaxHistory&gt;</span>
        <span class="nt">&lt;/rollingPolicy&gt;</span>
        <span class="nt">&lt;encoder</span> <span class="na">class=</span><span class="s">"ch.qos.logback.classic.encoder.PatternLayoutEncoder"</span><span class="nt">&gt;</span>
            <span class="c">&lt;!--格式化输出：%d表示日期，%thread表示线程名，%-5level：级别从左显示5个字符宽度%msg：日志消息，%n是换行符--&gt;</span>
            <span class="nt">&lt;pattern&gt;</span>${CONSOLE_LOG_PATTERN}-%caller{2}<span class="nt">&lt;/pattern&gt;</span>
        <span class="nt">&lt;/encoder&gt;</span>
        <span class="c">&lt;!--日志文件最大的大小--&gt;</span>
        <span class="nt">&lt;triggeringPolicy</span> <span class="na">class=</span><span class="s">"ch.qos.logback.core.rolling.SizeBasedTriggeringPolicy"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;MaxFileSize&gt;</span>100MB<span class="nt">&lt;/MaxFileSize&gt;</span>
        <span class="nt">&lt;/triggeringPolicy&gt;</span>
        <span class="nt">&lt;filter</span> <span class="na">class=</span><span class="s">"ch.qos.logback.classic.filter.LevelFilter"</span><span class="nt">&gt;</span><span class="c">&lt;!-- 只打印错误日志 --&gt;</span>
            <span class="nt">&lt;level&gt;</span>ERROR<span class="nt">&lt;/level&gt;</span>
            <span class="nt">&lt;onMatch&gt;</span>ACCEPT<span class="nt">&lt;/onMatch&gt;</span>
            <span class="nt">&lt;onMismatch&gt;</span>DENY<span class="nt">&lt;/onMismatch&gt;</span>
        <span class="nt">&lt;/filter&gt;</span>
    <span class="nt">&lt;/appender&gt;</span>

    <span class="nt">&lt;appender</span> <span class="na">name=</span><span class="s">"INFO"</span> <span class="na">class=</span><span class="s">"ch.qos.logback.core.rolling.RollingFileAppender"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;file&gt;</span>${logPath}/info.log<span class="nt">&lt;/file&gt;</span>
        <span class="nt">&lt;rollingPolicy</span> <span class="na">class=</span><span class="s">"ch.qos.logback.core.rolling.TimeBasedRollingPolicy"</span><span class="nt">&gt;</span>
            <span class="c">&lt;!--日志文件输出的文件名--&gt;</span>
            <span class="nt">&lt;FileNamePattern&gt;</span>${logPath}/bak/info.log.%d{yyyy-MM-dd}<span class="nt">&lt;/FileNamePattern&gt;</span>
            <span class="c">&lt;!--日志文件保留天数--&gt;</span>
            <span class="nt">&lt;MaxHistory&gt;</span>30<span class="nt">&lt;/MaxHistory&gt;</span>
        <span class="nt">&lt;/rollingPolicy&gt;</span>
        <span class="nt">&lt;encoder</span> <span class="na">class=</span><span class="s">"ch.qos.logback.classic.encoder.PatternLayoutEncoder"</span><span class="nt">&gt;</span>
            <span class="c">&lt;!--格式化输出：%d表示日期，%thread表示线程名，%-5level：级别从左显示5个字符宽度%msg：日志消息，%n是换行符--&gt;</span>
            <span class="nt">&lt;pattern&gt;</span>${CONSOLE_LOG_PATTERN}<span class="nt">&lt;/pattern&gt;</span>
        <span class="nt">&lt;/encoder&gt;</span>
        <span class="c">&lt;!--日志文件最大的大小--&gt;</span>
        <span class="nt">&lt;triggeringPolicy</span> <span class="na">class=</span><span class="s">"ch.qos.logback.core.rolling.SizeBasedTriggeringPolicy"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;MaxFileSize&gt;</span>100MB<span class="nt">&lt;/MaxFileSize&gt;</span>
        <span class="nt">&lt;/triggeringPolicy&gt;</span>

        <span class="nt">&lt;filter</span> <span class="na">class=</span><span class="s">"ch.qos.logback.classic.filter.LevelFilter"</span><span class="nt">&gt;</span><span class="c">&lt;!-- 只打印INFO日志 --&gt;</span>
            <span class="nt">&lt;level&gt;</span>INFO<span class="nt">&lt;/level&gt;</span>
            <span class="nt">&lt;onMatch&gt;</span>ACCEPT<span class="nt">&lt;/onMatch&gt;</span>
            <span class="nt">&lt;onMismatch&gt;</span>DENY<span class="nt">&lt;/onMismatch&gt;</span>
        <span class="nt">&lt;/filter&gt;</span>
    <span class="nt">&lt;/appender&gt;</span>

    <span class="nt">&lt;appender</span> <span class="na">name=</span><span class="s">"DEBUG"</span> <span class="na">class=</span><span class="s">"ch.qos.logback.core.rolling.RollingFileAppender"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;file&gt;</span>
            ${logPath}/debug.log
        <span class="nt">&lt;/file&gt;</span>
        <span class="nt">&lt;rollingPolicy</span> <span class="na">class=</span><span class="s">"ch.qos.logback.core.rolling.TimeBasedRollingPolicy"</span><span class="nt">&gt;</span>
            <span class="c">&lt;!--日志文件输出的文件名--&gt;</span>
            <span class="nt">&lt;FileNamePattern&gt;</span>${logPath}/bak/debug.log.%d{yyyy-MM-dd}<span class="nt">&lt;/FileNamePattern&gt;</span>
            <span class="c">&lt;!--日志文件保留天数--&gt;</span>
            <span class="nt">&lt;MaxHistory&gt;</span>30<span class="nt">&lt;/MaxHistory&gt;</span>
        <span class="nt">&lt;/rollingPolicy&gt;</span>
        <span class="nt">&lt;encoder</span> <span class="na">class=</span><span class="s">"ch.qos.logback.classic.encoder.PatternLayoutEncoder"</span><span class="nt">&gt;</span>
            <span class="c">&lt;!--格式化输出：%d表示日期，%thread表示线程名，%-5level：级别从左显示5个字符宽度%msg：日志消息，%n是换行符--&gt;</span>
            <span class="nt">&lt;pattern&gt;</span>${CONSOLE_LOG_PATTERN}<span class="nt">&lt;/pattern&gt;</span>
        <span class="nt">&lt;/encoder&gt;</span>
        <span class="c">&lt;!--日志文件最大的大小--&gt;</span>
        <span class="nt">&lt;triggeringPolicy</span> <span class="na">class=</span><span class="s">"ch.qos.logback.core.rolling.SizeBasedTriggeringPolicy"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;MaxFileSize&gt;</span>100MB<span class="nt">&lt;/MaxFileSize&gt;</span>
        <span class="nt">&lt;/triggeringPolicy&gt;</span>

        <span class="nt">&lt;filter</span> <span class="na">class=</span><span class="s">"ch.qos.logback.classic.filter.LevelFilter"</span><span class="nt">&gt;</span><span class="c">&lt;!-- 只打印DEBUG日志 --&gt;</span>
            <span class="nt">&lt;level&gt;</span>DEBUG<span class="nt">&lt;/level&gt;</span>
            <span class="nt">&lt;onMatch&gt;</span>ACCEPT<span class="nt">&lt;/onMatch&gt;</span>
            <span class="nt">&lt;onMismatch&gt;</span>DENY<span class="nt">&lt;/onMismatch&gt;</span>
        <span class="nt">&lt;/filter&gt;</span>
    <span class="nt">&lt;/appender&gt;</span>


    <span class="c">&lt;!-- 测试环境+开发环境. 多个使用逗号隔开. --&gt;</span>
    <span class="nt">&lt;springProfile</span> <span class="na">name=</span><span class="s">"test"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">"org.springframework.web"</span> <span class="na">level=</span><span class="s">"INFO"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">"com.jizhang.platform"</span> <span class="na">level=</span><span class="s">"INFO"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">"com.ibatis"</span> <span class="na">level=</span><span class="s">"${log.outside.level}"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">"com.ibatis.common.jdbc.SimpleDataSource"</span> <span class="na">level=</span><span class="s">"${log.outside.level}"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">"com.ibatis.common.jdbc.ScriptRunner"</span> <span class="na">level=</span><span class="s">"${log.outside.level}"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">"com.ibatis.sqlmap.engine.impl.SqlMapClientDelegate"</span> <span class="na">level=</span><span class="s">"${log.outside.level}"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">"java.sql.Connection"</span> <span class="na">level=</span><span class="s">"${log.outside.level}"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">"java.sql.Statement"</span> <span class="na">level=</span><span class="s">"${log.outside.level}"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">"java.sql.PreparedStatement"</span> <span class="na">level=</span><span class="s">"${log.outside.level}"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">"com.jizhang.platform.mapper"</span> <span class="na">level=</span><span class="s">"${log.outside.level}"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/springProfile&gt;</span>

    <span class="c">&lt;!-- 生产环境. --&gt;</span>
    <span class="nt">&lt;springProfile</span> <span class="na">name=</span><span class="s">"prod"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">"org.springframework.web"</span> <span class="na">level=</span><span class="s">"ERROR"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">"com.jizhang.platform"</span> <span class="na">level=</span><span class="s">"INFO"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">"com.ibatis"</span> <span class="na">level=</span><span class="s">"${log.outside.level}"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">"com.ibatis.common.jdbc.SimpleDataSource"</span> <span class="na">level=</span><span class="s">"${log.outside.level}"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">"com.ibatis.common.jdbc.ScriptRunner"</span> <span class="na">level=</span><span class="s">"${log.outside.level}"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">"com.ibatis.sqlmap.engine.impl.SqlMapClientDelegate"</span> <span class="na">level=</span><span class="s">"${log.outside.level}"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">"java.sql.Connection"</span> <span class="na">level=</span><span class="s">"${log.outside.level}"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">"java.sql.Statement"</span> <span class="na">level=</span><span class="s">"${log.outside.level}"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">"java.sql.PreparedStatement"</span> <span class="na">level=</span><span class="s">"${log.outside.level}"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">"com.jizhang.platform.mapper"</span> <span class="na">level=</span><span class="s">"${log.outside.level}"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/springProfile&gt;</span>

    <span class="c">&lt;!-- 日志输出级别 --&gt;</span>
    <span class="nt">&lt;root</span> <span class="na">level=</span><span class="s">"INFO"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;appender-ref</span> <span class="na">ref=</span><span class="s">"STDOUT"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;appender-ref</span> <span class="na">ref=</span><span class="s">"ERROR"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;appender-ref</span> <span class="na">ref=</span><span class="s">"INFO"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;appender-ref</span> <span class="na">ref=</span><span class="s">"DEBUG"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/root&gt;</span>
<span class="nt">&lt;/configuration&gt;</span>

</pre></table></code></div></div><h3 id="配置文件使用"><span class="me-2">配置文件使用</span><a href="#配置文件使用" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ol><li>将上述中的 logback-spring.xml 中的内容复制到项目 Resource 目录下，命名为： logback-spring.xml<li>在 spring properties中指定以下配置<div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>logging.config=classpath:logback-spring.xml
</pre></table></code></div></div><li>在 spring properties 配置文件中指定log 文件输出目录(绝对地址),默认为项目 jar包 执行目录，示例如下<div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>logging.file.path=/var/log/{appName}
</pre></table></code></div></div><li><p>配置 appName<br /> 在spring property 文件中指定<code class="language-plaintext highlighter-rouge">spring.application.name</code> 属性，logback 配置文件中配置了 <code class="language-plaintext highlighter-rouge">contextName</code>为 <code class="language-plaintext highlighter-rouge">spring.application.name</code></p><li>调用链表标识 在需要 输出 调用链标识的时候 配置时，使用 <code class="language-plaintext highlighter-rouge">org.slf4j.MDC</code>定义<code class="language-plaintext highlighter-rouge">trackId</code>字段，具体可参考下面代码<pre><code class="language-JAVA">MDC.put("trackId","trackId");
</code></pre><p>‘trackId’： 可以认为是方法调用过程中的唯一不变的字段，比如：userId,或者操作的字段id,或者接到的请求跟踪id 等</p><li>业务标识 需要输出 业务标识字段的时候，使用<code class="language-plaintext highlighter-rouge">MDC</code>配置 <code class="language-plaintext highlighter-rouge">bizId</code>字段。</ol><p><strong>注意</strong>： MDC 的实现是通过 <code class="language-plaintext highlighter-rouge">ThreadLocal&lt;Map&lt;String,String&gt;&gt;</code>实现的,具体可是查阅 ch.qos.logback.classic.util.LogbackMDCAdapter 源码，所以要注意 MDC中字段的更新问题，在多线程环境中尤其要注意线程中的任务执行完毕的时候记得 调用 MDC.clear()方法清理。</p><p>如上配置可达到以下效果</p><pre><code class="language-log">2020-06-01 15:34:19.630 [zl-platform][bizId:bizExample][main] INFO  com.jizhang.testlog.TestlogApplication [trackId:trackExample] - info message!!!
2020-06-01 15:34:19.630 [zl-platform][bizId:bizExample][main] ERROR com.jizhang.testlog.TestlogApplication [trackId:trackExample] - error message!!!!
2020-06-01 15:34:19.633 [zl-platform][bizId:bizExample][main] ERROR com.jizhang.testlog.TestlogApplication [trackId:trackExample] - java.lang.Exception: messages!!!,exception!
</code></pre><h2 id="参考"><span class="me-2">参考</span><a href="#参考" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li><a href="https://www.jianshu.com/p/546e9aace657">Java日志记录最佳实践</a><li><a href="https://mp.weixin.qq.com/s/c3dTTkbTNqnZTy_Da19I6Q">优秀日志实践准则</a></ul><h1 id="nginx-日志规范">Nginx 日志规范</h1><h2 id="日志格式"><span class="me-2">日志格式</span><a href="#日志格式" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Nginx 日志格式统一为一下格式：</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '
                      '$status $body_bytes_sent "$http_referer" '
                      '"$http_user_agent" "$http_x_forwarded_for"'
                      'rt=$request_time uct="$upstream_connect_time" uht="$upstream_header_time" urt="$upstream_response_time"';

</pre></table></code></div></div><p>以上格式在默认格式的基础上添加了反向代理的转发相关信息，供排查问题用。</p><h2 id="目录格式"><span class="me-2">目录格式</span><a href="#目录格式" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Nginx 默认日志目录为 /var/log/nginx， 反向代理的服务目录 日志目录无需设置，在默认目录下会有相关文件夹。</p><h2 id="参考-1"><span class="me-2">参考</span><a href="#参考-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li><a href="https://docs.nginx.com/nginx/admin-guide/monitoring/logging/">Nginx 官方</a><li><a href="https://blog.qiniu.com/archives/8779">如何建设高吞吐量的日志平台</a><li><a href="https://sematext.com/blog//logstash-alternatives/">Logstash Alternatives</a></ul><h2 id="日志收集"><span class="me-2">日志收集</span><a href="#日志收集" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>考虑到目前日志主要用于 ES 分析，暂定方案为 fileBeats 收集各个系统的日志（包括nginx），统一汇总到logstash 平台然后过滤分析到 ES搜索/kibana分析</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href='/categories/%E7%AC%94%E8%AE%B0/'>笔记</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/%E6%80%BB%E7%BB%93/" class="post-tag no-text-decoration" >总结</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> 本文由作者按照 <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> 进行授权</div><div class="share-wrapper"> <span class="share-label text-muted me-1">分享</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=%E5%90%8E%E7%AB%AF%E7%A0%94%E5%8F%91%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95%E8%A7%84%E8%8C%83%20-%20HeX&url=https%3A%2F%2Farchzi.github.io%2Fposts%2Flog-conduct%2F" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter" > <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=%E5%90%8E%E7%AB%AF%E7%A0%94%E5%8F%91%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95%E8%A7%84%E8%8C%83%20-%20HeX&u=https%3A%2F%2Farchzi.github.io%2Fposts%2Flog-conduct%2F" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook" > <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Farchzi.github.io%2Fposts%2Flog-conduct%2F&text=%E5%90%8E%E7%AB%AF%E7%A0%94%E5%8F%91%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95%E8%A7%84%E8%8C%83%20-%20HeX" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram" > <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-bs-toggle="tooltip" data-bs-placement="top" title="分享链接" data-title-succeed="链接已复制！" > </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">最近更新</div><ul class="post-content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/Set_SSH_NO_Password/">REHL Linux 服务器设置免密登录</a></ul></div><div id="access-tags"><div class="panel-heading">热门标签</div><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/%E7%AC%94%E8%AE%B0/">笔记</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E6%80%BB%E7%BB%93/">总结</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E6%8C%96%E5%9D%91/">挖坑</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E5%A4%87%E4%BB%BD/">备份</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E7%BF%BB%E8%AF%91%E5%AD%A6%E4%B9%A0/">翻译学习</a></div></div></div><div id="toc-wrapper" class="ps-0 pe-4 mb-5"><div class="panel-heading ps-3 pt-2 mb-2">文章内容</div><nav id="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-3 pe-xl-4 mt-5"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ms-1" data-toc-skip> 相关文章</h3><div class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><div class="col"> <a href="/posts/how-to-collect-log/" class="card post-preview h-100"><div class="card-body"> <em class="small" data-ts="1593622800" data-df="YYYY/MM/DD" > 2020/07/02 </em><h4 class="pt-0 my-2" data-toc-skip>日志收集</h4><div class="text-muted small"><p> logstash 缺点： 性能问题 具体 benchmark 可以参考链接 不支持缓存，典型的替代方案还得依赖 kafka 或者Redis 作为中心缓存池 Flume Flume基于流式数据的、使用简单的（借助配置文件即可）、健壮的、容错的。 Flume的简单体现在：写一个source、channel、sink之后，一条命令就...</p></div></div></a></div><div class="col"> <a href="/posts/Start-with-Gradle/" class="card post-preview h-100"><div class="card-body"> <em class="small" data-ts="1622566800" data-df="YYYY/MM/DD" > 2021/06/02 </em><h4 class="pt-0 my-2" data-toc-skip>Gradle 基础学习笔记</h4><div class="text-muted small"><p> 介绍 gralde 是一个 开源的自动化构建工具，设计的初衷就是为了足够灵活，来满足几乎所有软件的构建需求。并且具有以下的功能： 高性能 只编译需要编译的部分（因为 task 的输入和输出变动），甚至可以在不同的机器上利用 build cache（有共享 cache 的条件下） 基于 JVM 熟悉java 的人很轻松就能学会 基于约定实现 gradle 借鉴了...</p></div></div></a></div><div class="col"> <a href="/posts/Java-Interface/" class="card post-preview h-100"><div class="card-body"> <em class="small" data-ts="1622563200" data-df="YYYY/MM/DD" > 2021/06/02 </em><h4 class="pt-0 my-2" data-toc-skip>Java interface</h4><div class="text-muted small"><p></p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/how-to-collect-log/" class="btn btn-outline-primary" prompt="上一篇" ><p>日志收集</p></a> <a href="/posts/Java-Interface/" class="btn btn-outline-primary" prompt="下一篇" ><p>Java interface</p></a></div><script type="text/javascript"> (function () { const origin = 'https://giscus.app'; const iframe = 'iframe.giscus-frame'; const lightTheme = 'light'; const darkTheme = 'dark_dimmed'; let initTheme = lightTheme; const html = document.documentElement; if ( (html.hasAttribute('data-mode') && html.getAttribute('data-mode') === 'dark') || (!html.hasAttribute('data-mode') && window.matchMedia('(prefers-color-scheme: dark)').matches) ) { initTheme = darkTheme; } let giscusAttributes = { src: 'https://giscus.app/client.js', 'data-repo': 'archzi/archzi.github.io', 'data-repo-id': 'R_kgDOHe9jcQ', 'data-category': 'Q&A', 'data-category-id': 'DIC_kwDOHe9jcc4CQKJF', 'data-mapping': 'pathname', 'data-reactions-enabled': '1', 'data-emit-metadata': '0', 'data-theme': initTheme, 'data-input-position': 'bottom', 'data-lang': 'zh-CN', crossorigin: 'anonymous', async: '' }; let giscusScript = document.createElement('script'); Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value) ); document.getElementById('tail-wrapper').appendChild(giscusScript); addEventListener('message', (event) => { if ( event.source === window && event.data && event.data.direction === ModeToggle.ID ) { /* global theme mode changed */ const mode = event.data.message; const theme = mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme; const message = { setConfig: { theme: theme } }; const giscus = document.querySelector(iframe).contentWindow; giscus.postMessage({ giscus: message }, origin); } }); })(); </script></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">热门标签</div><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/%E7%AC%94%E8%AE%B0/">笔记</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E6%80%BB%E7%BB%93/">总结</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E6%8C%96%E5%9D%91/">挖坑</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E5%A4%87%E4%BB%BD/">备份</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E7%BF%BB%E8%AF%91%E5%AD%A6%E4%B9%A0/">翻译学习</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div></div><footer><div class="container px-lg-4"><div class="d-flex justify-content-center align-items-center text-muted mx-md-3"><p>本站由 <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> 生成，采用 <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> 主题。</p><p>© 2023 <a href="https://github.com/archzi">archzi</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="除非另有说明，本网站上的博客文章均由作者按照知识共享署名 4.0 国际 (CC BY 4.0) 许可协议进行授权。" >保留部分权利。</span></p></div></div></footer><div id="mask"></div><button id="back-to-top" aria-label="back-to-top" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">发现新版本的内容。</p><button type="button" class="btn btn-primary" aria-label="Update"> 更新 </button></div></div><script src="https://cdn.jsdelivr.net/combine/npm/jquery@3.7.0/dist/jquery.min.js,npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js,npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/lazysizes@5.3.2/lazysizes.min.js,npm/magnific-popup@1.1.0/dist/jquery.magnific-popup.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.7/dayjs.min.js,npm/dayjs@1.11.7/locale/zh.min.js,npm/dayjs@1.11.7/plugin/relativeTime.min.js,npm/dayjs@1.11.7/plugin/localizedFormat.min.js,npm/tocbot@4.21.0/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script> /* Note: dependent library will be loaded in `js-selector.html` */ SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="px-1 px-sm-2 px-lg-4 px-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5"></p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
